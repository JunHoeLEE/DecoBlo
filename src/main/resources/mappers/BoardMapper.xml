<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.decoblog.www.board.dao.BoardMapper">

<!-- 글 목록 --> 
<select id="select" parameterType="map" resultType="Bbs">
	SELECT
		bbsNo
		, boardNo
		, bbsTitle
		, bbsContent
		, bbsCount
		, bbsLike
		, bbsParent
		, bbsDepth
		, bbsSeq
		, to_char(bbsRegdate, 'YYYY-MM-DD') bbsRegdate
		, to_char(bbsEditDate, 'YYYY-MM-DD') bbsEditDate
	FROM
		DB_BBS
	WHERE
		${searchItem} like '%' || #{searchWord} || '%'
	ORDER BY
		bbsNo desc
</select>

<!-- 글 상세보기 -->
<select id="selectOneBbs" parameterType="int" resultType="Bbs">
	SELECT
		bbsNo
		, bbsTitle
		, bbsContent
		, bbsCount
		, bbsLike
		, to_char(bbsRegdate, 'YYYY-MM-DD') AS bbsRegdate
		, to_char(bbsEditDate, 'YYYY-MM-DD') AS bbsEditDate
	FROM 
		DB_BBS
	WHERE
		bbsNo = #{bbsNo}
	ORDER BY
		bbsRegdate desc
</select>

<!-- 첨부파일 상세보기 -->
<select id="selectOneBbsAttach" parameterType="int" resultType="BbsAttach">
	SELECT
		attachNo
		, attachBbsNo 
		, attachOriginalFile 
		, attachSavedFile 
	FROM
		DB_BBS_ATTACH
	WHERE
		attachBbsNo = #{attachBbsNo}
	ORDER BY
		attachNo desc
</select>

<!-- 글 쓰기 -->
<insert id="insertBbs" parameterType="Bbs">
	INSERT INTO DB_BBS (
		bbsNo
		, boardNo
		, bbsTitle
		, bbsContent
		, bbsLike
		, bbsParent
		, bbsDepth
		, bbsSeq
		, bbsRegdate
		, bbsEditDate
	) VALUES (
		db_bbs_seq.NEXTVAL
		, #{boardNo}
		, #{bbsTitle}
		, #{bbsContent}
		, #{bbsLike}
		, #{bbsParent}
		, #{bbsDepth}
		, #{bbsSeq}
		, SYSDATE
		, #{bbsEditDate}	
	)
</insert>

<!-- 첨부파일 넣기 -->
<insert id="insertAttach" parameterType="BbsAttach">
	INSERT INTO db_bbsattach (
		attachNo
		, attachBbsNo
		, attachOriginalFile
		, attachSavedFile
	) VALUES (
		db_bbs_attach_seq.NEXTVAL
		, #{attachBbsNo}
		, #{attachOriginalFile}
		, #{attachSavedFile}
	)
</insert>


<!-- 글 수정 -->
<update id="updateBbs" parameterType="Bbs">
	UPDATE 
		db_bbs 
	SET
		bbsTitle  = #{bbsTitle}
		, bbsContent = #{bbsContent}
		, bbsEditDate = sysdate
	WHERE
		bbsNo = #{bbsNo}
</update>


<!-- 첨부파일 수정 -->
<update id="updateBbsAttach" parameterType="BbsAttach">
	UPDATE 
		db_bbs_attach 
	SET
		attachNo = db_bbs_attach_seq.NEXTVAL
		, attachOriginalFile = #{attachOriginalFile}
		, attachSavedFile = #{attachSavedFile}
	WHERE
		attachBbsNo = #{attachBbsNo}
</update>






<!-- 글 삭제 -->
<delete id="deleteBbs" parameterType="Bbs">
	DELETE FROM 
		db_bbs
	WHERE
		bbsNo = #{bbsNo}
</delete>

<!-- 첨부파일 삭제 -->
<delete id="deleteBbsAttach" parameterType="BbsAttach">
	DELETE FROM 
		DB_BBS_ATTACH
	WHERE
		attachBbsNo = #{attachBbsNo}
</delete>

<!-- 전체 글 개수 조회 -->
<select id="getTotalBbs" parameterType="map" resultType="int">
	SELECT
		count(*)
	FROM
		DB_BBS
	WHERE
		${searchItem} like '%' || #{searchWord} || '%'
</select>

<!-- 조회수 +1 -->
<update id="updateBbsCount" parameterType="int">
	UPDATE 
		DB_BBS 
	SET
		bbsCount = bbsCount+1
	WHERE
		bbsNo = #{bbsNo}
</update>



</mapper>